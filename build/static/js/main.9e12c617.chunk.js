(this["webpackJsonpfullstack-chris-demo"]=this["webpackJsonpfullstack-chris-demo"]||[]).push([[0],{35:function(e,t,n){},63:function(e,t,n){},99:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n(0),o=n.n(s),r=n(53),a=n.n(r),i=n(11),u=(n(63),n(2)),l=(n(35),n(18)),d=o.a.createContext();function h(){return Object(s.useContext)(d)}function p(e){var t=e.children,n=Object(s.useState)(null),o=Object(l.a)(n,2),r=o[0],a=o[1],i=Object(s.useState)({connection:{},messages:[]}),h=Object(l.a)(i,2),p=h[0],j=h[1],m=Object(u.e)();Object(s.useEffect)((function(){r||fetch("https://port-contact-server.herokuapp.com",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"},"Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com"}).then((function(e){return e.json()})).then((function(e){!0===e.success&&(console.log(e.user),a(e.user),m.push("/chat"))})).catch((function(e){return console.log(e)}))}),[]);var f={user:r,setUser:a,conversation:p,setConversation:j};return Object(c.jsx)(d.Provider,{value:f,children:t})}var j=n(34),m=n.n(j),f=n(55);function O(e){var t=h(),n=t.user,o=t.setUser,r=Object(s.useRef)(),a=function(){var e=Object(f.a)(m.a.mark((function e(t){var c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),c={username:r.current.username.value},e.next=4,n.connections;case 4:if(!e.sent){e.next=10;break}return e.next=7,n.connections.find((function(e){return e.username===c.username}));case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=!1;case 11:e.t0?console.log("User ".concat(c.username," is already a contact.")):(console.log("Request to add this contact: ".concat(JSON.stringify(c))),fetch("https://port-contact-server.herokuapp.com/connections",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}).then((function(e){return e.json()})).then((function(e){!0===e.success?o((function(t){t.connections=e.updatedContacts})):console.log(e.message)})).catch((function(e){return console.log(e)})));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsx)("div",{children:Object(c.jsxs)("form",{className:"add-contact",ref:r,onSubmit:a,children:[Object(c.jsx)("input",{name:"username",type:"text",placeholder:"Username"}),Object(c.jsx)("button",{type:"submit",children:"Add"})]})})}var b=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL,v=void 0===b?"https://port-contact-server.herokuapp.com":b;function g(e){var t=h(),n=t.user,s=t.setUser,o=t.setConversation;return Object(c.jsxs)("div",{className:"connections",children:[n.connections&&n.connections.map((function(e,t){return Object(c.jsxs)("div",{className:"contact",children:[Object(c.jsx)("button",{onClick:function(){return function(e){console.log(e);var t=e._id;fetch(v+"/messages/"+t,{method:"GET",credentials:"include","Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com"}).then((function(e){return e.json()})).then((function(t){!1===t.success?console.log("Error fetching messages."):o({connection:e,messages:t.messages})}))}(e)},children:e.username}),Object(c.jsx)("button",{className:"delete-user-button",onClick:function(){fetch("https://port-contact-server.herokuapp.com/connections/"+e._id,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){!0===e.success?s((function(t){return t.connections.contacts=e.updatedContacts})):console.log(e.message)})).catch((function(e){console.error("Error: ",e)}))},children:"x"})]},t)})),Object(c.jsx)(O,{})]})}var x=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL,S=void 0===x?"https://port-contact-server.herokuapp.com":x;function C(){var e=Object(u.e)(),t=h(),n=t.user,s=t.setUser;return Object(c.jsxs)("div",{className:"app-nav",children:[n&&Object(c.jsx)(g,{}),Object(c.jsx)(i.b,{to:"/",children:Object(c.jsx)("h1",{className:"app-title",children:"Private Alpha v0.01"})}),n&&Object(c.jsx)("button",{className:"logout-button",onClick:function(){fetch(S+"/logout",{credentials:"include","Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com"}).then((function(e){return e.json()})).then((function(t){!0===t.success?(s(null),e.push("/")):console.log(t.message)})).catch((function(e){return console.log(e)}))},children:"Log out"})]})}var _=n(57),E=n(56),T=n.n(E),y=o.a.createContext();function A(e){var t=e.children,n=T()();return Object(c.jsx)(y.Provider,{value:n,children:t})}var N=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL,k=void 0===N?"https://port-contact-server.herokuapp.com":N;function w(e){var t=Object(u.e)(),n=h(),o=n.user,r=n.setUser,a=n.conversation,i=n.setConversation,d=Object(s.useRef)(),p=Object(s.useRef)(),j=Object(s.useRef)(),m=Object(s.useState)(""),f=Object(l.a)(m,2),O=f[0],b=f[1],v=Object(s.useContext)(y);v.on("new message",(function(e){i(i((function(t){a.messages=[].concat(Object(_.a)(t.messages),[e])})))}));Object(s.useEffect)((function(){o||fetch(k+"/",{credentials:"include",headers:{"Content-Type":"application/json"},"Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com"}).then((function(e){return e.json()})).then((function(e){!1===e.authenticated?(console.log("Start session to enter chat."),t.push("/")):(console.log("Authorized user: ".concat(e.user)),r(e.user))})).catch((function(e){return console.log(e)}))}),[]),Object(s.useEffect)((function(){var e=window.innerHeight;b("".concat(e-180,"px")),p.current&&p.current.scrollIntoView({block:"end",behavior:"smooth"})}),[a]);return Object(c.jsx)(c.Fragment,{children:o&&Object(c.jsxs)("div",{className:"Chat",children:[Object(c.jsxs)("div",{className:"chat-log",style:{height:O},ref:d,children:[a&&a.messages.map((function(e,t){return Object(c.jsx)("div",{id:t,className:o._id===e.senderId?"my-message-line":"their-message-line",children:Object(c.jsx)("div",{className:o._id===e.senderId?"my-message":"their-message",onClick:function(){return function(e,t){fetch(k+"/messages",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),d.current.children[t].classList.add("hidden")}(e,t)},children:e.content})})})),Object(c.jsx)("div",{ref:p})]}),Object(c.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),j.current.message.value){var t={senderId:o._id,recipientId:a.connection._id,content:j.current.message.value};v.emit("new message",t),j.current.message.value=""}},id:"message-form",ref:j,children:[Object(c.jsx)("input",{name:"message",type:"text",placeholder:"Gotta xat fast",autoComplete:"off"}),Object(c.jsx)("button",{type:"submit",className:"material-icons",children:"flash_on"})]})]})})}function P(){var e=Object(u.e)(),t=Object(s.useRef)(),n=h().setUser;return Object(c.jsxs)("form",{className:"register-form",ref:t,onSubmit:function(c){c.preventDefault();var s={username:t.current.username.value,email:t.current.email.value,password:t.current.password.value};console.log(s),fetch("https://port-contact-server.herokuapp.com/register",{method:"POST",headers:{"Content-Type":"application/json"},"Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com",credentials:"include",body:JSON.stringify(s)}).then((function(e){return e.json()})).then((function(t){!0===t.success?(n(t.user),e.push("/chat")):console.log(t.message)})).catch((function(e){return console.log(e)})),t.current.reset()},children:[Object(c.jsx)("h2",{children:"New user"}),Object(c.jsxs)("div",{children:["port.contact/",Object(c.jsx)("input",{type:"text",name:"username",placeholder:"Username",required:!0})]}),Object(c.jsx)("input",{type:"email",name:"email",placeholder:"E-mail",required:!0}),Object(c.jsx)("input",{type:"password",name:"password",placeholder:"Password",required:!0}),Object(c.jsx)("button",{type:"submit",children:"Create"})]})}function R(){var e=h().setUser,t=Object(s.useRef)(),n=Object(u.e)();return Object(c.jsxs)("form",{className:"login-form",ref:t,onSubmit:function(c){c.preventDefault();var s={username:t.current.username.value,password:t.current.password.value};console.log(s),fetch("https://port-contact-server.herokuapp.com/login",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"},"Access-Control-Allow-Origin":"https://port-contact-server.herokuapp.com",credentials:"include"}).then((function(e){return e.json()})).then((function(t){!0===t.success?(console.log(t.user),e(t.user),n.push("/chat")):console.log(t.message)})).catch((function(e){return console.log(e)})),t.current.reset()},children:[Object(c.jsx)("h2",{children:"Login"}),Object(c.jsx)("input",{type:"text",name:"username",placeholder:"Username"}),Object(c.jsx)("input",{type:"password",name:"password",placeholder:"Password"}),Object(c.jsx)("button",{type:"submit",children:"Submit"})]})}var U=function(){return Object(c.jsx)("div",{className:"App",children:Object(c.jsx)(A,{children:Object(c.jsxs)(p,{children:[Object(c.jsx)(C,{}),Object(c.jsx)(u.a,{exact:!0,path:"/",children:Object(c.jsxs)("div",{className:"user-selection",children:[Object(c.jsx)(R,{}),Object(c.jsx)(P,{})]})}),Object(c.jsx)(u.a,{exact:!0,path:"/chat",children:Object(c.jsx)(w,{})})]})})})};a.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(i.a,{children:Object(c.jsx)(U,{})})}),document.getElementById("root"))}},[[99,1,2]]]);
//# sourceMappingURL=main.9e12c617.chunk.js.map